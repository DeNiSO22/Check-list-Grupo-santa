<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Cadastro de Usu√°rio</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 2rem; }
    .container { background: #fff; max-width: 400px; margin: auto; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    h2 { margin-bottom: 1.5rem; text-align: center; }
    .form-group { position: relative; margin-bottom: 1rem; }
    label { display: block; margin-bottom: .5rem; font-weight: bold; }
    input { width: 100%; padding: .75rem; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }

    /* √çcone olho para mostrar senha */
    .toggle-password {
      position: absolute;
      top: 49%; /* ajustado para ficar um pouco acima do centro */
      right: 12px;
      cursor: pointer;
      user-select: none;
      font-size: 1.1rem;
      color: #666;
    }

    button { width: 100%; padding: .75rem; background: #4299e1; color: #fff; border: none; border-radius: 4px; font-size: 1rem; cursor: pointer; }
    button:hover { background: #3182ce; }
    .msg { margin-top: 1rem; text-align: center; font-weight: bold; }
    .msg.success { color: green; }
    .msg.error { color: red; }
    a { display: block; margin-top: 1rem; text-align: center; color: #4299e1; text-decoration: none; font-size: .9rem; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Cadastro de Usu√°rio</h2>
    <form id="formCadastro" autocomplete="off">
      <div class="form-group">
        <label for="cpf">CPF:</label>
        <input type="text" id="cpf" placeholder="Ex: 12345678900" autocomplete="off" required />
      </div>
      <div class="form-group">
        <label for="senha">Senha:</label>
        <input type="password" id="senha" placeholder="Digite sua senha" autocomplete="new-password" required />
        <span class="toggle-password" data-target="senha">üëÅÔ∏è</span>       
      </div>
      <div class="form-group">
        <label for="confirmSenha">Confirme a Senha:</label>
        <input type="password" id="confirmSenha" placeholder="Repita sua senha" autocomplete="new-password" required />
        <span class="toggle-password" data-target="confirmSenha">üëÅÔ∏è</span>
      </div>
      <button type="button" id="btnCadastrar">Cadastrar</button>
    </form>
    <div id="msgCadastro" class="msg"></div>
    <a href="index.html">J√° tenho conta</a>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // Alternar visibilidade da senha
    document.querySelectorAll('.toggle-password').forEach(el => {
      el.addEventListener('click', () => {
        const input = document.getElementById(el.dataset.target);
        const type = input.type === 'password' ? 'text' : 'password';
        input.type = type;
        el.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
      });
    });

    // Fun√ß√£o para validar CPF
    function validarCPF(cpf) {
      cpf = cpf.replace(/[^\d]+/g, '');
      if (cpf.length !== 11 || /^(\d)\1+$/.test(cpf)) return false;

      let soma = 0;
      for (let i = 0; i < 9; i++) {
        soma += parseInt(cpf.charAt(i)) * (10 - i);
      }
      let resto = (soma * 10) % 11;
      if (resto === 10 || resto === 11) resto = 0;
      if (resto !== parseInt(cpf.charAt(9))) return false;

      soma = 0;
      for (let i = 0; i < 10; i++) {
        soma += parseInt(cpf.charAt(i)) * (11 - i);
      }
      resto = (soma * 10) % 11;
      if (resto === 10 || resto === 11) resto = 0;
      return resto === parseInt(cpf.charAt(10));
    }

    const msg = document.getElementById('msgCadastro');
    const btn = document.getElementById('btnCadastrar');
    const form = document.getElementById('formCadastro');

    btn.addEventListener('click', () => {
      const cpf = document.getElementById('cpf').value.trim();
      const senha = document.getElementById('senha').value;
      const confirmSenha = document.getElementById('confirmSenha').value;

      if (!cpf || !senha || !confirmSenha) {
        msg.textContent = 'Preencha todos os campos.';
        msg.className = 'msg error';
        return;
      }

      if (!validarCPF(cpf)) {
        msg.textContent = 'CPF inv√°lido. Verifique os n√∫meros digitados.';
        msg.className = 'msg error';
        return;
      }

      if (senha !== confirmSenha) {
        msg.textContent = 'As senhas n√£o conferem.';
        msg.className = 'msg error';
        return;
      }

      let usuarios = [];
      try {
        usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
      } catch (e) {
        console.error('Erro ao ler usu√°rios:', e);
        localStorage.removeItem('usuarios');
        usuarios = [];
      }

      const index = usuarios.findIndex(u => u.login === cpf);
      if (index !== -1) {
        usuarios[index].senha = senha;
        msg.textContent = 'Senha atualizada com sucesso!';
      } else {
        usuarios.push({ login: cpf, senha });
        msg.textContent = 'Cadastro realizado com sucesso!';
      }

      localStorage.setItem('usuarios', JSON.stringify(usuarios));
      msg.className = 'msg success';
      form.reset();
    });

    // Impede digita√ß√£o de letras no campo CPF
    document.getElementById('cpf').addEventListener('input', function () {
      this.value = this.value.replace(/\D/g, '');
    });
  });
</script>

</body>
</html>
